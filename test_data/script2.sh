#!/bin/bash
# an exon is CDS if 11=13 and 12=14 (complete overlap with cds_map.txt), in this case there is no UTR coords
# join -t$'\t' -1 10 -2 1 -o 1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,1.10,1.11,1.12,2.2,2.3 input.gff3 cds_map3.txt

cat test | awk -F'\t' '\
  {if ($11 > $13 && $12 < $14 || $11 == $13 && $14 >= $12 || $11 >= $13 && $12 == $14) \
  {print "CDS\t"$4"\t"$5"\t"$10} \
  else if ($11 > $14 || $12 < $13 || $13 > $11 && $14 >= $12 && ($13-$11) > ($5-$4) || $12 >= $14 && $14 >= $11 && ($5-$4) < ($12-$14)) \
  {print "UTR\t"$4"\t"$5"\t"$10} \
  else if ($13 > $11 && $14 >= $12 && ($13-$11) <= ($5-$4)) \
  {print "UTR\t"$4"\t"($4+($13-$11-1))"\t"$10"\n" \
         "CDS\t"($4+($13-$11))"\t"$5"\t"$10} \
  else if ($12 >= $14 && $11 >= $13 && ($5-$4) >= ($12-$14)) \
  {print "CDS\t"$4"\t"($5-($12-$14))"\t"$10"\n" \
         "UTR\t"($5-($12-$14-1))"\t"$5"\t"$10} \
  else if ($12 > $14 && $13 > $11) \
  {print "tUTR\t"$4"\t"($4+($13-$11-1))"\t"$10"\n" \
         "tCDS\t"($4+($13-$11))"\t"$5"\t"$10"\n" \
         "tUTR\t"($5-($12-$14-1))"\t"$5"\t"$10} \
  else \
  {print $3"\t"$4"\t"$5"\t"$10} \
  }'