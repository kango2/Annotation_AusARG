#!/bin/bash
# an exon is CDS if 11=13 and 12=14 (complete overlap with cds_map.txt), in this case there is no UTR coords
export input="/g/data/xl04/jc4878/Annotation_AusARG/test_data/test2_neg"
awk -F'\t' '\
  {if ($11 == $13 && $12 == $14) \
  {print $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA"} \
  else if ($13 == "NA" && $14 == "NA") \
  {print $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\t"$11"\t"$12} \
  else if ($7 == "+" && $12 == $14 && $11 != $13) \
  {print $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$11"\t"$13-1"\n" \
         $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA"} \
  else if ($7 == "+" && $11 == $13 && $12 != $14) \
  {print $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA\n" \
         $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$14+1"\t"$12} \
  else if ($7 == "+" && $13 != "NA" && $14 != "NA" && $11 != $13 && $12 != $14) \
  {print $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$11"\t"$13-1"\n" \
         $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA\n" \
         $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$14+1"\t"$12} \
  else if ($7 == "-" && $11 == $13 && $12 != $14) \
  {print $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$14+1"\t"$12"\n" \
         $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA"} \
  else if ($7 == "-" && $11 != $13 && $12 == $14) \
  {print $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA\n" \
         $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$11"\t"$13-1} \
  else if ( $7 == "-" && $13 != "NA" && $14 != "NA" && $11 != $13 && $12 != $14) \
  {print $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$14+1"\t"$12"\n" \
         $1"\t"$2"\tCDS\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\t"$13"\t"$14"\tNA\tNA\n" \
         $1"\t"$2"\tUTR\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9"\t"$10"\t"$11"\t"$12"\tNA\tNA\t"$11"\t"$13-1} \
  else {print $0}}' ${input} | \
awk -F'\t' '\
  {if ($7 == "+" && $3 == "CDS" && $11 != $13 && $12 == $14) \
  {print $1"\t"$2"\t"$3"\t"$4+$13-$11"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($3 == "CDS" && $11 == $13 && $12 == $14) \
  {print $1"\t"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "+" && $3 == "CDS" && $11 == $13 && $12 != $14) \
  {print $1"\t"$2"\t"$3"\t"$4"\t"$5-$12+$14"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "+" && $3 == "CDS" && $11 != $13 && $12 != $14) \
  {print $1"\t"$2"\t"$3"\t"$4+$13-$11"\t"$5-$12+$14"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($3 == "UTR" && $11 == $15 && $12 == $16) \
  {print $1"\t"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "+" && $3 == "UTR" && $11 == $15 && $12 != $16) \
  {print $1"\t"$2"\t"$3"\t"$4"\t"$4+$16-$15"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "+" && $3 == "UTR" && $11 != $15 && $12 == $16) \
  {print $1"\t"$2"\t"$3"\t"$4+$15-$11"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "-" && $3 == "CDS" && $11 == $13 && $12 != $14) \
  {print $1"\t"$2"\t"$3"\t"$5-$14+$13"\t"$5"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "-" && $3 == "CDS" && $11 != $13 && $12 == $14) \
  {print $1"\t"$2"\t"$3"\t"$4"\t"$5-$13+$11"\t"$6"\t"$7"\t"$8"\t"$9} \
  else if ($7 == "-" && $3 == "CDS" && $11 != $13 && $12 != $14) \
  {print $1"\t"$2"\t"$3"\t"$"\t"$5-$13+$11"\t"$6"\t"$7"\t"$8"\t"$9} \
  }'
